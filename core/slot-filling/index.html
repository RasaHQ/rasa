
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Slot Filling</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/banner.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/button.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/button.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Interactive Learning" href="../interactive-learning/" />
    <link rel="prev" title="Using Slots" href="../slots/" />

  <!-- Google Tag Manager -->
  <script type="application/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MMHSZCS');</script>
  <!-- End Google Tag Manager -->
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />
  <meta itemprop="image" content="https://rasa.com/assets/img/facebook-og.png">
  <meta property="og:title" content="Slot Filling" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://rasa.com/assets/img/facebook-og.png" />
  <meta property="og:url" content="https://rasa.com/docs/rasa/core/slot-filling" />
  
    <meta name="description" content="Follow a rule-based process of information gathering using FormActions
in open source bot framework Rasa Stack." />
    <meta itemprop="description" content="Follow a rule-based process of information gathering using FormActions
in open source bot framework Rasa Stack.">
    <meta name="twitter:description" content="Follow a rule-based process of information gathering using FormActions
in open source bot framework Rasa Stack." />
    <meta property="og:description" content="Follow a rule-based process of information gathering using FormActions
in open source bot framework Rasa Stack." />
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@Rasa_HQ">
  <meta name="twitter:title" content="Slot Filling">
  <meta name="twitter:creator" content="@Rasa_HQ">
  <meta name="twitter:image" content="https://rasa.com/assets/img/facebook-og.png">

  <link rel="stylesheet" href="../../_static/xq-light.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/fontawesome/css/fontawesome-all.css" type="text/css" />
  <script type="text/javascript" src="https://storage.googleapis.com/docs-theme/clipboard.min.js"></script>
  
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />


  </head><body>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MMHSZCS" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<div class="nav-top">
  <div class="nav-container">
    <ul>
      <li>
    	<a href="/docs" class="brand-link">
    	    <h1 class="brand">
    	        <img src="../../_static/rasa_logo.svg" width="80px" height="40px" title="Rasa logo" alt="Rasa logo">
    	    </h1>
    	    <span class="logo extension">docs</span>
    	</a>
      </li>
      	
          
      	    <li><a href=/docs/getting-started/>Getting Started</a></li>
      	  
      	
          
      	    <li class="active"><a href=/docs/rasa/>Rasa</a></li>
      	  
      	
          
      	    <li><a href=/docs/rasa-x/>Rasa X</a></li>
      	  
      	
    </ul>
    <ul class="nav">
      <input type="text" class="search" placeholder="Search documentation...">
      <li>
        <a href="https://github.com/rasaHQ/" target="_blank"><button class="button btn-ghost white"> <i class="fab fa-github"></i>GitHub</button></a>
      </li>

      <li>
        <a href="https://forum.rasa.com" target="_blank"><button class="button"><i class="fas fa-comments"></i> Ask the Community</button></a>
      </li>

    </ul>
  </div>
</div>

  
    
      <div class="sidebar-extended"></div>
    
  

  
      
      <div class="document">
    
  

    
      
        
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation/">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/">Rasa Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../command-line-interface/">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture/">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../channels/">Messaging and Voice Channels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../evaluating-models/">Evaluating Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../server/">Running the Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cloud-storage/">Storing Models in the Cloud</a></li>
</ul>
<p class="caption"><span class="caption-text">NLU</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../nlu/using-only-nlu/">Using NLU Only</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nlu/data-format/">Training Data Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nlu/choosing-pipeline/">Choosing a Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nlu/languages/">Language Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nlu/entities/">Entity Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nlu/components/">Component Configuration</a></li>
</ul>
<p class="caption"><span class="caption-text">Core</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../stories/">Story Data Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../domains/">Domains</a></li>
<li class="toctree-l1"><a class="reference internal" href="../responses/">Responses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../run-code-in-custom-actions/">Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../policies/">Training and Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slots/">Using Slots</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Slot Filling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactive-learning/">Interactive Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fallbacks/">Fallback Actions</a></li>
</ul>
<p class="caption"><span class="caption-text">Conversation Design</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dialogue-elements/about/">Dialogue Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dialogue-elements/small-talk/">Small Talk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dialogue-elements/completing-tasks/">Completing Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dialogue-elements/guiding-users/">Guiding Users</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/action-server/">Action Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/rasa-http-api/">HTTP API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/jupyter/">Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/agent/">Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/custom-nlu-components/">Custom NLU Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/events/">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/tracker/">Tracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/tracker-stores/">Tracker Stores</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/brokers/">Event Brokers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/featurizer/">Featurization</a></li>
</ul>

<div class="versions">
    <p class="caption">Versions</p>
    <div class="versions-content">
      <div>
        <span class="current-version">
          viewing: post-merge-docs
        </span>
      </div>
      <div class="other-versions">
          <p>branches</p>
          <div class="dropdown-content">
              <a href="../.././post-merge-docs/core/slot-filling/">post-merge-docs</a>
          </div>
      </div>
    </div>
</div>


        </div>
      </div>
      
    
      
        
      
        <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="slot-filling">
<span id="id1"></span><h1>Slot Filling<a class="headerlink" href="#slot-filling" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There is an in-depth tutorial <a class="reference external" href="https://blog.rasa.com/building-contextual-assistants-with-rasa-formaction/">here</a> about how to use Rasa Forms for slot filling.</p>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#configuration-file" id="id2">Configuration File</a></li>
<li><a class="reference internal" href="#basics" id="id3">Basics</a></li>
<li><a class="reference internal" href="#custom-slot-mappings" id="id4">Custom slot mappings</a></li>
<li><a class="reference internal" href="#validating-user-input" id="id5">Validating user input</a></li>
<li><a class="reference internal" href="#handling-unhappy-paths" id="id6">Handling unhappy paths</a></li>
<li><a class="reference internal" href="#the-requested-slot-slot" id="id7">The requested_slot slot</a></li>
<li><a class="reference internal" href="#handling-conditional-slot-logic" id="id8">Handling conditional slot logic</a></li>
<li><a class="reference internal" href="#debugging" id="id9">Debugging</a></li>
</ul>
</div>
<p>One of the most common conversation patterns is to collect a few pieces of
information from a user in order to do something (book a restaurant, call an
API, search a database, etc.). This is also called <strong>slot filling</strong>.</p>
<p>If you need to collect multiple pieces of information in a row, we recommended
that you create a <code class="docutils literal notranslate"><span class="pre">FormAction</span></code>. This is a single action which contains the
logic to loop over the required slots and ask the user for this information.
There is a full example using forms in the <code class="docutils literal notranslate"><span class="pre">examples/formbot</span></code> directory of
Rasa Core.</p>
<p>When you define a form, you need to add it to your domain file.
If your form’s name is <code class="docutils literal notranslate"><span class="pre">restaurant_form</span></code>, your domain would look like this:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">forms</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">restaurant_form</span>
<span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
<p>See <code class="docutils literal notranslate"><span class="pre">examples/formbot/domain.yml</span></code> for an example.</p>
<div class="section" id="configuration-file">
<h2><a class="toc-backref" href="#id2">Configuration File</a><a class="headerlink" href="#configuration-file" title="Permalink to this headline">¶</a></h2>
<p>To use forms, you also need to include the <code class="docutils literal notranslate"><span class="pre">FormPolicy</span></code> in your policy
configuration file. For exmple:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">policies</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;FormPolicy&quot;</span>
</pre></div>
</div>
<p>see <code class="docutils literal notranslate"><span class="pre">examples/formbot/domain.yml</span></code> for an example.</p>
</div>
<div class="section" id="basics">
<span id="section-form-basics"></span><h2><a class="toc-backref" href="#id3">Basics</a><a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h2>
<p>Using a <code class="docutils literal notranslate"><span class="pre">FormAction</span></code>, you can describe <em>all</em> of the happy paths with a single
story. By “happy path”, we mean that whenever you ask a user for some information,
they respond with the information you asked for.</p>
<p>If we take the example of the restaurant bot, this single story describes all of the
happy paths.</p>
<div class="highlight-story notranslate"><div class="highlight"><pre><span></span>## happy path
* request_restaurant
    - restaurant_form
    - form{&quot;name&quot;: &quot;restaurant_form&quot;}
    - form{&quot;name&quot;: null}
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">FormAction</span></code> will only request slots which haven’t already been set.
If a user starts the conversation with
<cite>I’d like a vegetarian Chinese restaurant for 8 people</cite>, then they won’t be
asked about the <code class="docutils literal notranslate"><span class="pre">cuisine</span></code> and <code class="docutils literal notranslate"><span class="pre">num_people</span></code> slots.</p>
<p>Note that for this story to work, your slots should be <a class="reference external" href="https://rasa.com/docs/core/api/slots_api/#unfeaturized-slot">unfeaturized</a>.
If any of these slots are featurized, your story needs to include <code class="docutils literal notranslate"><span class="pre">slot{}</span></code> events
to show these slots being set. In that case, the easiest way to create valid stories
is to use <span class="xref std std-ref">interactive-learning</span> .</p>
<p>In the story above, <code class="docutils literal notranslate"><span class="pre">restaurant_form</span></code> is the name of our form action.
Here is an example of what it looks like.
You need to define three methods:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">name</span></code>: the name of this action</li>
<li><code class="docutils literal notranslate"><span class="pre">required_slots</span></code>: a list of slots that need to be filled for the <code class="docutils literal notranslate"><span class="pre">submit</span></code> method to work.</li>
<li><code class="docutils literal notranslate"><span class="pre">submit</span></code>: what to do at the end of the form, when all the slots have been filled.</li>
</ul>
<p>Once the form action gets called for the first time,
the form gets activated and the <code class="docutils literal notranslate"><span class="pre">FormPolicy</span></code> jumps in.
The <code class="docutils literal notranslate"><span class="pre">FormPolicy</span></code> is extremely simple and just always predicts the form action.
See <a class="reference internal" href="#section-unhappy"><span class="std std-ref">Handling unhappy paths</span></a> for how to work with unexpected user input.</p>
<p>Every time the form action gets called, it will ask the user for the next slot in
<code class="docutils literal notranslate"><span class="pre">required_slots</span></code> which is not already set.
It does this by looking for a template called <code class="docutils literal notranslate"><span class="pre">utter_ask_{slot_name}</span></code>,
so you need to define these in your domain file for each required slot.</p>
<p>Once all the slots are filled, the <code class="docutils literal notranslate"><span class="pre">submit()</span></code> method is called, where you can
use the information you’ve collected to do something for the user, for example
querying a restaurant API.
If you don’t want your form to do anything at the end, just use <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">[]</span></code>
as your submit method.
After the submit method is called, the form is deactivated,
and other policies in your Core model will be used to predict the next action.</p>
</div>
<div class="section" id="custom-slot-mappings">
<h2><a class="toc-backref" href="#id4">Custom slot mappings</a><a class="headerlink" href="#custom-slot-mappings" title="Permalink to this headline">¶</a></h2>
<p>Some slots (like <code class="docutils literal notranslate"><span class="pre">cuisine</span></code>) can be picked up using a single entity, but a
<code class="docutils literal notranslate"><span class="pre">FormAction</span></code> can also support yes/no questions and free-text input.
The <code class="docutils literal notranslate"><span class="pre">slot_mappings</span></code> method defines how to extract slot values from user responses.</p>
<p>Here’s an example for the restaurant bot:</p>
<p>The predefined functions work as follows:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">self.from_entity(entity=entity_name,</span> <span class="pre">intent=intent_name)</span></code>
will look for an entity called <code class="docutils literal notranslate"><span class="pre">entity_name</span></code> to fill a slot
<code class="docutils literal notranslate"><span class="pre">slot_name</span></code> regardless of user intent if <code class="docutils literal notranslate"><span class="pre">intent_name</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code>
else only if the users intent is <code class="docutils literal notranslate"><span class="pre">intent_name</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">self.from_intent(intent=intent_name,</span> <span class="pre">value=value)</span></code>
will fill slot <code class="docutils literal notranslate"><span class="pre">slot_name</span></code> with <code class="docutils literal notranslate"><span class="pre">value</span></code> if user intent is <code class="docutils literal notranslate"><span class="pre">intent_name</span></code>.
To make a boolean slot, take a look at the definition of <code class="docutils literal notranslate"><span class="pre">outdoor_seating</span></code>
above. Note: Slot will not be filled with user intent of message triggering
the form action. Use <code class="docutils literal notranslate"><span class="pre">self.from_trigger_intent</span></code> below.</li>
<li><code class="docutils literal notranslate"><span class="pre">self.from_trigger_intent(intent=intent_name,</span> <span class="pre">value=value)</span></code>
will fill slot <code class="docutils literal notranslate"><span class="pre">slot_name</span></code> with <code class="docutils literal notranslate"><span class="pre">value</span></code> if form was triggered with user
intent <code class="docutils literal notranslate"><span class="pre">intent_name</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">self.from_text(intent=intent_name)</span></code> will use the next
user utterance to fill the text slot <code class="docutils literal notranslate"><span class="pre">slot_name</span></code> regardless of user intent
if <code class="docutils literal notranslate"><span class="pre">intent_name</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code> else only if user intent is <code class="docutils literal notranslate"><span class="pre">intent_name</span></code>.</li>
<li>If you want to allow a combination of these, provide them as a list as in the
example above</li>
</ul>
</div>
<div class="section" id="validating-user-input">
<h2><a class="toc-backref" href="#id5">Validating user input</a><a class="headerlink" href="#validating-user-input" title="Permalink to this headline">¶</a></h2>
<p>After extracting a slot value from user input, the form will try to validate the
value of the slot. By default, this only checks if the requested slot was extracted.
If you want to add custom validation, for example to check a value against a database,
you can do this by overwriting the <code class="docutils literal notranslate"><span class="pre">validate()</span></code> method.
Here is an example which checks if the extracted cuisine slot belongs to a
list of supported cuisines.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">cuisine_db</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Text</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Database of supported cuisines&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="s2">&quot;caribbean&quot;</span><span class="p">,</span>
            <span class="s2">&quot;chinese&quot;</span><span class="p">,</span>
            <span class="s2">&quot;french&quot;</span><span class="p">,</span>
            <span class="s2">&quot;greek&quot;</span><span class="p">,</span>
            <span class="s2">&quot;indian&quot;</span><span class="p">,</span>
            <span class="s2">&quot;italian&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mexican&quot;</span><span class="p">,</span>
        <span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">is_int</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="n">Text</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Check if a string is an integer&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
<p>You can also deactivate the form directly during this validation step (in case the
slot is filled with something that you are certain can’t be handled) by returning
<code class="docutils literal notranslate"><span class="pre">self.deactivate()</span></code></p>
<p>If nothing is extracted from the user’s utterance for any of the required slots, an
<code class="docutils literal notranslate"><span class="pre">ActionExecutionRejection</span></code> error will be raised, meaning the action execution
was rejected and therefore Core will fall back onto a different policy to
predict another action.</p>
</div>
<div class="section" id="handling-unhappy-paths">
<span id="section-unhappy"></span><h2><a class="toc-backref" href="#id6">Handling unhappy paths</a><a class="headerlink" href="#handling-unhappy-paths" title="Permalink to this headline">¶</a></h2>
<p>Of course your users will not always respond with the information you ask of them.
Typically, users will ask questions, make chitchat, change their mind, or otherwise
stray from the happy path. The way this works with forms is that a form will raise
an <code class="docutils literal notranslate"><span class="pre">ActionExecutionRejection</span></code> if the user didn’t provide the requested information.
You need to handle events that might cause <code class="docutils literal notranslate"><span class="pre">ActionExecutionRejection</span></code> errors
in your stories. For example, if you expect your users to chitchat with your bot,
you could add a story like this:</p>
<div class="highlight-story notranslate"><div class="highlight"><pre><span></span>## chitchat
* request_restaurant
    - restaurant_form
    - form{&quot;name&quot;: &quot;restaurant_form&quot;}
* chitchat
    - utter_chitchat
    - restaurant_form
    - form{&quot;name&quot;: null}
</pre></div>
</div>
<p>In some situations, users may change their mind in the middle of form action
and decide not to go forward with their initial request. In cases like this, the
assistant should stop asking for the requested slots. You can handle such situations
gracefully using a default action <code class="docutils literal notranslate"><span class="pre">action_deactivate_form</span></code> which will deactivate
the form and reset the requested slot. An example story of such conversation could
look as follows:</p>
<div class="highlight-story notranslate"><div class="highlight"><pre><span></span>## chitchat
* request_restaurant
    - restaurant_form
    - form{&quot;name&quot;: &quot;restaurant_form&quot;}
* stop
    - utter_ask_continue
* deny
    - action_deactivate_form
    - form{&quot;name&quot;: null}
</pre></div>
</div>
<p>It is <strong>strongly</strong> recommended that you build these stories using interactive learning.
If you write these stories by hand you will likely miss important things.
Please read <a class="reference internal" href="../interactive-learning/#section-interactive-learning-forms"><span class="std std-ref">Interactive Learning with Forms</span></a>
on how to use interactive learning with forms.</p>
</div>
<div class="section" id="the-requested-slot-slot">
<h2><a class="toc-backref" href="#id7">The requested_slot slot</a><a class="headerlink" href="#the-requested-slot-slot" title="Permalink to this headline">¶</a></h2>
<p>The slot <code class="docutils literal notranslate"><span class="pre">requested_slot</span></code> is automatically added to the domain as an
unfeaturized slot. If you want to make it featurized, you need to add it
to your domain file as a categorical slot. You might want to do this if you
want to handle your unhappy paths differently depending on what slot is
currently being asked from the user. For example, say your users respond
to one of the bot’s questions with another question, like <em>why do you need to know that?</em>
The response to this <code class="docutils literal notranslate"><span class="pre">explain</span></code> intent depends on where we are in the story.
In the restaurant case, your stories would look something like this:</p>
<div class="highlight-story notranslate"><div class="highlight"><pre><span></span>## explain cuisine slot
* request_restaurant
    - restaurant_form
    - form{&quot;name&quot;: &quot;restaurant_form&quot;}
    - slot{&quot;requested_slot&quot;: &quot;cuisine&quot;}
* explain
    - utter_explain_cuisine
    - restaurant_form
    - slot{&quot;cuisine&quot;: &quot;greek&quot;}
    ( ... all other slots the form set ... )
    - form{&quot;name&quot;: null}

## explain num_people slot
* request_restaurant
    - restaurant_form
    - form{&quot;name&quot;: &quot;restaurant_form&quot;}
    - slot{&quot;requested_slot&quot;: &quot;num_people&quot;}
* explain
    - utter_explain_num_people
    - restaurant_form
    - slot{&quot;cuisine&quot;: &quot;greek&quot;}
    ( ... all other slots the form set ... )
    - form{&quot;name&quot;: null}
</pre></div>
</div>
<p>Again, is is <strong>strongly</strong> recommended that you use interactive
learning to build these stories.
Please read <a class="reference internal" href="../interactive-learning/#section-interactive-learning-forms"><span class="std std-ref">Interactive Learning with Forms</span></a>
on how to use interactive learning with forms.</p>
</div>
<div class="section" id="handling-conditional-slot-logic">
<span id="conditional-logic"></span><h2><a class="toc-backref" href="#id8">Handling conditional slot logic</a><a class="headerlink" href="#handling-conditional-slot-logic" title="Permalink to this headline">¶</a></h2>
<p>Many forms require more logic than just requesting a list of fields.
For example, if someone requests <code class="docutils literal notranslate"><span class="pre">greek</span></code> as their cuisine, you may want to
ask if they are looking for somewhere with outside seating.</p>
<p>You can achieve this by writing some logic into the <code class="docutils literal notranslate"><span class="pre">required_slots()</span></code> method,
for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">required_slots</span><span class="p">(</span><span class="n">tracker</span><span class="p">):</span>
   <span class="c1"># type: () -&gt; List[Text]</span>
   <span class="sd">&quot;&quot;&quot;A list of required slots that the form has to fill&quot;&quot;&quot;</span>

   <span class="k">if</span> <span class="n">tracker</span><span class="o">.</span><span class="n">get_slot</span><span class="p">(</span><span class="s1">&#39;cuisine&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;greek&#39;</span><span class="p">:</span>
     <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;cuisine&quot;</span><span class="p">,</span> <span class="s2">&quot;num_people&quot;</span><span class="p">,</span> <span class="s2">&quot;outdoor_seating&quot;</span><span class="p">,</span>
             <span class="s2">&quot;preferences&quot;</span><span class="p">,</span> <span class="s2">&quot;feedback&quot;</span><span class="p">]</span>
   <span class="k">else</span><span class="p">:</span>
     <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;cuisine&quot;</span><span class="p">,</span> <span class="s2">&quot;num_people&quot;</span><span class="p">,</span>
             <span class="s2">&quot;preferences&quot;</span><span class="p">,</span> <span class="s2">&quot;feedback&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>This mechanism is quite general and you can use it to build many different
kinds of logic into your forms.</p>
</div>
<div class="section" id="debugging">
<h2><a class="toc-backref" href="#id9">Debugging</a><a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h2>
<p>The first thing to try is to run your bot with the <code class="docutils literal notranslate"><span class="pre">debug</span></code> flag, see <a class="reference internal" href="../../command-line-interface/#cli-usage"><span class="std std-ref">Command Line Interface</span></a> for details.
If you are just getting started, you probably only have a few hand-written stories.
This is a great starting point, but
you should give your bot to people to test <strong>as soon as possible</strong>. One of the guiding principles
behind Rasa Core is:</p>
<blockquote class="pull-quote">
<div>Learning from real conversations is more important than designing hypothetical ones</div></blockquote>
<p>So don’t try to cover every possibility in your hand-written stories before giving it to testers.
Real user behavior will always surprise you!</p>
</div>
</div>


	    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
	    <script type="text/javascript"> docsearch({
	     apiKey: '1f9e0efb89e98543f6613a60f847b176',
	     indexName: 'rasa',
	     inputSelector: 'body > div.nav-top > .nav-container > .nav > input',
	     debug: false // Set debug to true if you want to inspect the dropdown
	    });
	    </script>
          </div>

          <div class="footer">
            <div class="questions">
              Stuck?
              <a class="reference external" href="https://forum.rasa.com" target="_blank">Ask a Question</a>
              or
              <a class="reference external" href="https://github.com/rasahq/rasa/issues" target="_blank">Create an Issue</a>
            </div>
            <div class="social">
              <a href="https://github.com/RasaHQ" target="_blank" title="GitHub"><i class="fab fa-github"></i></a>
              <a href="https://stackoverflow.com/search?q=rasa" target="_blank" title="Stack Overflow"><i class="fab fa-stack-overflow"></i></a>
              <a href="https://www.youtube.com/channel/UCJ0V6493mLvqdiVwOKWBODQ" target="_blank" title="YouTube"><i class="fab fa-youtube"></i></a>
              <a href="https://twitter.com/rasa_hq" target="_blank" title="Twitter"><i class="fab fa-twitter"></i></a>
            </div>

            <div class="copyright small">
            &copy;2019, Rasa Technologies | <a href="https://rasa.com/imprint/" target="_blank">Imprint</a> | <a href="https://rasa.com/privacy-policy/" target="_blank">Privacy Policy</a>
            
            </div>

          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
    <!-- consent-banner -->
    <div class="consent-banner">
        <div class="container">
            <img class="cookie-icon" src="../../_static/cookie.svg" alt="cookie">
            <p>
                In order to give you a better service Rasa uses cookies.
                By continuing to browse the site you are agreeing to our use of <a href="//rasa.com/privacy-policy" target="_blank">cookies</a>.
                <a class="agree" href="#">I agree</a>.
            </p>
        </div>
    </div>
  </div>

    

  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag(...arguments) {
      dataLayer.push(...arguments);
    }
    gtag('js', new Date());
    gtag('config', 'UA-87333416-1', {
      'anonymize_ip': true,
    });
  </script>
  <script src="https://rasa.com/assets/js/js.cookies.js"></script>
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script type="text/javascript" src="https://www.googletagmanager.com/gtag/js?id=UA-87333416-1"></script>
  <script type="text/javascript" src="https://rasa.com/assets/js/userId.js"></script>

  <script type="text/javascript">
    var clipboard = new ClipboardJS('.copyable');
    clipboard.on('success', function(e) {
      gtag('event', e.action, {
        'event_category': 'code',
        'event_label': e.text
      });
      const id = e.text.replace(/ /g,'-');
      document.getElementById(id).classList.add('visible');
      setTimeout(function(){
        document.getElementById(id).classList.remove('visible');},
        800
      );
    });
    clipboard.on('error', function(e) {
      console.log(e);
    });

    /* Consent Manager */
    $(document).ready(function() {
      if(!document.cookie.match(/^(.*;)?\s*rasa-cookie-consent\s*=\s*[^;]+(.*)?$/))
        $('.consent-banner').addClass('visible');

      $('.consent-banner .agree').click(function(e){
        e.preventDefault();
        var CookieDate = new Date;
        CookieDate.setFullYear(CookieDate.getFullYear() + 1);
        document.cookie = 'rasa-cookie-consent=true; expires=' + CookieDate.toUTCString() + '; domain=.rasa.com';
        $('.consent-banner').remove();
      });
    });
  </script>

  <!-- onsite anchor fix (otherwise anchors scroll to far) -->
  <script>
    /* Adapted from https://stackoverflow.com/a/13067009/1906073 */
    (function(document, history, location) {
      var HISTORY_SUPPORT = !!(history && history.pushState);

      var anchorScrolls = {
        ANCHOR_REGEX: /^#[^ ]+$/,
        OFFSET_HEIGHT_PX: 66,

        /**
         * Establish events, and fix initial scroll position if a hash is provided.
         */
        init: function() {
          this.scrollToCurrent();
          $(window).on('hashchange', $.proxy(this, 'scrollToCurrent'));
          $('body').on('click', 'a', $.proxy(this, 'delegateAnchors'));
        },

        /**
         * Return the offset amount to deduct from the normal scroll position.
         * Modify as appropriate to allow for dynamic calculations
         */
        getFixedOffset: function() {
          return this.OFFSET_HEIGHT_PX;
        },

        /**
         * If the provided href is an anchor which resolves to an element on the
         * page, scroll to it.
         * @param  {String} href
         * @return {Boolean} - Was the href an anchor.
         */
        scrollIfAnchor: function(href, pushToHistory) {
          var match, anchorOffset;

          if(!this.ANCHOR_REGEX.test(href)) {
            return false;
          }

          match = document.getElementById(href.slice(1));

          if(match) {
            anchorOffset = $(match).offset().top - this.getFixedOffset();
            $('html, body').animate({ scrollTop: anchorOffset});

            // Add the state to history as-per normal anchor links
            if(HISTORY_SUPPORT && pushToHistory) {
              history.pushState({}, document.title, location.pathname + href);
            }
          }

          return !!match;
        },

        /**
         * Attempt to scroll to the current location's hash.
         */
        scrollToCurrent: function(e) {
          if(this.scrollIfAnchor(window.location.hash) && e) {
            e.preventDefault();
          }
        },

        /**
         * If the click event's target was an anchor, fix the scroll position.
         */
        delegateAnchors: function(e) {
          var elem = e.target;

          if(this.scrollIfAnchor(elem.getAttribute('href'), true)) {
            e.preventDefault();
          }
        }
      };

      $(document).ready($.proxy(anchorScrolls, 'init'));
    })(window.document, window.history, window.location);

  </script>
  <script type="text/javascript" src="https://rasa.com/assets/js/u-info.js"></script>
  </body>
</html>