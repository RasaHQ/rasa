
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retrieval Actions</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/banner.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Interactive Learning" href="../interactive-learning/" />
    <link rel="prev" title="Forms" href="../forms/" />

  <!-- Google Tag Manager -->
  <script type="opt-in" data-type="application/javascript" data-name="analytics">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-MMHSZCS');</script>
  <!-- End Google Tag Manager -->
   
  
  <meta itemprop="image" content="https://rasa.com/assets/img/facebook-og.png">
  <meta property="og:title" content="Retrieval Actions" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://rasa.com/assets/img/facebook-og.png" />
  <meta property="og:url" content="https://rasa.com/docs/rasa/core/retrieval-actions" />
  
    <meta name="description" content="Use a retrieval model to select chatbot responses
in open source bot framework Rasa." />
    <meta itemprop="description" content="Use a retrieval model to select chatbot responses
in open source bot framework Rasa.">
    <meta name="twitter:description" content="Use a retrieval model to select chatbot responses
in open source bot framework Rasa." />
    <meta property="og:description" content="Use a retrieval model to select chatbot responses
in open source bot framework Rasa." />
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@Rasa_HQ">
  <meta name="twitter:title" content="Retrieval Actions">
  <meta name="twitter:creator" content="@Rasa_HQ">
  <meta name="twitter:image" content="https://rasa.com/assets/img/facebook-og.png">

  <link rel="stylesheet" href="../../_static/xq-light.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/fontawesome/css/fontawesome-all.css" type="text/css" />
  <link rel="stylesheet" type="text/css" href="https://rasa.com/assets/css/klaro.css">
  <script defer type="text/javascript" src="https://rasa.com/assets/js/klaro_config.js"></script>
  <script defer type="text/javascript" src="https://rasa.com/assets/js/klaro.js"></script>
  <script defer type="text/javascript" src="../../_static/ace/src-min-noconflict/ace.js"></script>
  <script defer type="text/javascript" src="../../_static/chatblock/rasa-chatblock.min.js"></script>
  <script type="text/javascript" src="https://storage.googleapis.com/docs-theme/clipboard.min.js"></script>
  
    <link rel="icon" sizes="192x192" href="../../_static/icon-192x192.png">
    <link rel="apple-touch-icon" href="../../_static/icon-192x192.png" />
  
  
    
      <link rel="canonical" href="https://rasa.com/docs/rasa/core/retrieval-actions/"/>
    
  


  </head><body>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe data-name="analytics" data-src="https://www.googletagmanager.com/ns.html?id=GTM-MMHSZCS" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<div class="announce-bar" role="banner">
  These docs are for version 1.x of Rasa Open Source.
  <a href="https://rasa.com/docs/rasa/">Docs for the new version 2.0 can be found here.</a>
</div>

<div class="nav-top">
  <div class="nav-container">
    <ul class="main-nav nav">
      <li>
      <a href="https://rasa.com/docs/" class="brand-link">
          <img src="../../_static/rasa_logo.svg" width="80px" height="40px" title="Rasa logo" alt="Rasa logo">
    	    <span class="logo extension">docs</span>
    	</a>
      </li>
    </ul>
    <ul class="secondary-nav nav">
      <li>
        <a href="https://github.com/rasaHQ/" target="_blank"><button class="button btn-ghost white"> <i class="fab fa-github"></i>GitHub</button></a>
      </li>
      <li>
        <a href="https://forum.rasa.com" target="_blank"><button class="button"><i class="fas fa-comments"></i> Ask the Community</button></a>
      </li>
    </ul>
  </div>
</div>

  
    
      <div class="sidebar-extended"></div>
    
  

  
    
      <div class="document">
    
  

    
      
        
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/installation/">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/rasa-tutorial/">Tutorial: Rasa Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/building-assistants/">Tutorial: Building Assistants</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/command-line-interface/">Command Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/architecture/">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/messaging-and-voice-channels/">Messaging and Voice Channels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/testing-your-assistant/">Testing Your Assistant</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/setting-up-ci-cd/">Setting up CI/CD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/validate-files/">Validate Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/configuring-http-api/">Configuring the HTTP API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/how-to-deploy/">Deploying Your Rasa Assistant</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/cloud-storage/">Cloud Storage</a></li>
</ul>
<p class="caption"><span class="caption-text">NLU</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../nlu/about/">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nlu/using-nlu-only/">Using NLU Only</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nlu/training-data-format/">Training Data Format</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nlu/language-support/">Language Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nlu/choosing-a-pipeline/">Choosing a Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nlu/components/">Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nlu/entity-extraction/">Entity Extraction</a></li>
</ul>
<p class="caption"><span class="caption-text">Core</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about/">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../stories/">Stories</a></li>
<li class="toctree-l1"><a class="reference internal" href="../domains/">Domains</a></li>
<li class="toctree-l1"><a class="reference internal" href="../responses/">Responses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../actions/">Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reminders-and-external-events/">Reminders and External Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../policies/">Policies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../slots/">Slots</a></li>
<li class="toctree-l1"><a class="reference internal" href="../forms/">Forms</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Retrieval Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactive-learning/">Interactive Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fallback-actions/">Fallback Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../knowledge-bases/">Knowledge Base Actions</a></li>
</ul>
<p class="caption"><span class="caption-text">Conversation Design</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dialogue-elements/dialogue-elements/">Dialogue Elements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dialogue-elements/small-talk/">Small Talk</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dialogue-elements/completing-tasks/">Completing Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dialogue-elements/guiding-users/">Guiding Users</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api/action-server/">Action Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/http-api/">HTTP API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/jupyter-notebooks/">Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/agent/">Agent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/custom-nlu-components/">Custom NLU Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/rasa-sdk/">Rasa SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/events/">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/tracker/">Tracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/tracker-stores/">Tracker Stores</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/event-brokers/">Event Brokers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/lock-stores/">Lock Stores</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/training-data-importers/">Training Data Importers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/core-featurization/">Featurization of Conversations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/tensorflow_usage/">TensorFlow Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migration-guide/">Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog/">Rasa Open Source Change Log</a></li>
</ul>
<p class="caption"><span class="caption-text">Migrate from (beta)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../migrate-from/google-dialogflow-to-rasa/">Dialogflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migrate-from/facebook-wit-ai-to-rasa/">Wit.ai</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migrate-from/microsoft-luis-to-rasa/">LUIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../migrate-from/ibm-watson-to-rasa/">IBM Watson</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Glossary</a></li>
</ul>

<div class="versions">
    <p class="caption">Versions</p>
    <div class="versions-content">
      <div>
        <span class="current-version">
          viewing: 1.10.12
        </span>
      </div>
      <div class="other-versions">
          <p>tags</p>
          <div class="dropdown-content">
              <a href="../../../1.10.20/core/retrieval-actions/">1.10.20</a>
              <a href="../../../1.10.19/core/retrieval-actions/">1.10.19</a>
              <a href="../../../1.10.18/core/retrieval-actions/">1.10.18</a>
              <a href="../../../1.10.17/core/retrieval-actions/">1.10.17</a>
              <a href="../../../1.10.16/core/retrieval-actions/">1.10.16</a>
              <a href="../../../1.10.15/core/retrieval-actions/">1.10.15</a>
              <a href="../../../1.10.14/core/retrieval-actions/">1.10.14</a>
              <a href="../../../1.10.13/core/retrieval-actions/">1.10.13</a>
              <a href="../../../1.10.12/core/retrieval-actions/">1.10.12</a>
              <a href="../../../1.10.11/core/retrieval-actions/">1.10.11</a>
              <a href="../../../1.10.10/core/retrieval-actions/">1.10.10</a>
              <a href="../../../1.10.9/core/retrieval-actions/">1.10.9</a>
              <a href="../../../1.10.8/core/retrieval-actions/">1.10.8</a>
              <a href="../../../1.10.7/core/retrieval-actions/">1.10.7</a>
              <a href="../../../1.10.6/core/retrieval-actions/">1.10.6</a>
              <a href="../../../1.10.5/core/retrieval-actions/">1.10.5</a>
              <a href="../../../1.10.4/core/retrieval-actions/">1.10.4</a>
              <a href="../../../1.10.3/core/retrieval-actions/">1.10.3</a>
              <a href="../../../1.10.2/core/retrieval-actions/">1.10.2</a>
              <a href="../../../1.10.1/core/retrieval-actions/">1.10.1</a>
              <a href="../../../1.10.0/core/retrieval-actions/">1.10.0</a>
              <a href="../../../1.9.7/core/retrieval-actions/">1.9.7</a>
              <a href="../../../1.9.6/core/retrieval-actions/">1.9.6</a>
              <a href="../../../1.9.5/core/retrieval-actions/">1.9.5</a>
              <a href="../../../1.9.4/core/retrieval-actions/">1.9.4</a>
              <a href="../../../1.9.3/core/retrieval-actions/">1.9.3</a>
              <a href="../../../1.9.2/core/retrieval-actions/">1.9.2</a>
              <a href="../../../1.9.1/core/retrieval-actions/">1.9.1</a>
              <a href="../../../1.9.0/core/retrieval-actions/">1.9.0</a>
              <a href="../../../1.8.3/core/retrieval-actions/">1.8.3</a>
              <a href="../../../1.8.2/core/retrieval-actions/">1.8.2</a>
              <a href="../../../1.8.1/core/retrieval-actions/">1.8.1</a>
              <a href="../../../1.8.0/core/retrieval-actions/">1.8.0</a>
              <a href="../../../1.7.4/core/retrieval-actions/">1.7.4</a>
              <a href="../../../1.7.3/core/retrieval-actions/">1.7.3</a>
              <a href="../../../1.7.2/core/retrieval-actions/">1.7.2</a>
              <a href="../../../1.7.1/core/retrieval-actions/">1.7.1</a>
              <a href="../../../1.7.0/core/retrieval-actions/">1.7.0</a>
              <a href="../../../1.6.2/core/retrieval-actions/">1.6.2</a>
              <a href="../../../1.5.3/core/retrieval-actions/">1.5.3</a>
              <a href="../../../1.4.6/core/retrieval-actions/">1.4.6</a>
              <a href="../../../1.3.10/core/retrieval-actions/">1.3.10</a>
              <a href="../../../1.2.9/index/">1.2.9</a>
          </div>
      </div>
    </div>
</div>


        </div>
      </div>
      
    
      
        
      
        <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  


    
    



    <p class="scv-banner"><a href="../../../1.10.20/core/retrieval-actions/"><b>Warning:</b> This document is for an old version of Rasa. The latest version is 1.10.20.</a></p>
<div class="section" id="retrieval-actions">
<span id="id1"></span><h1>Retrieval Actions<a class="headerlink" href="#retrieval-actions" title="Permalink to this headline">Â¶</a></h1>

  <div class="edit-link">
    <a class="reference external" href="https://github.com/RasaHQ/rasa/edit/master/docs/core/retrieval-actions.rst" target="_blank"><i class="fab fa-github" style="font-size: 85%; padding-right: 4px;"></i>SUGGEST EDITS</a>
  </div><div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This feature is experimental.
We introduce experimental features to get feedback from our community, so we encourage you to try it out!
However, the functionality might be changed or removed in the future.
If you have feedback (positive or negative) please share it with us on the <a class="reference external" href="https://forum.rasa.com">forum</a>.
Also, currently we do not support adding new annotations in Rasa X if your training data contains retrieval actions.
Once we have gathered enough feedback and weâ€™re happy with the training data format, weâ€™ll add support for training response retrieval models in Rasa X.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is an in-depth blog post <a class="reference external" href="https://blog.rasa.com/response-retrieval-models/">here</a> about how to use retrieval
actions for handling single turn interactions.</p>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#about" id="id3">About</a></p></li>
<li><p><a class="reference internal" href="#training-data" id="id4">Training Data</a></p></li>
<li><p><a class="reference internal" href="#config-file" id="id5">Config File</a></p></li>
<li><p><a class="reference internal" href="#domain" id="id6">Domain</a></p></li>
<li><p><a class="reference internal" href="#multiple-retrieval-actions" id="id7">Multiple Retrieval Actions</a></p></li>
<li><p><a class="reference internal" href="#parsing-response-selector-output" id="id8">Parsing Response Selector Output</a></p></li>
</ul>
</div>
<div class="section" id="about">
<h2><a class="toc-backref" href="#id3">About</a><a class="headerlink" href="#about" title="Permalink to this headline">Â¶</a></h2>
<p>Retrieval actions are designed to make it simpler to work with <a class="reference internal" href="../../dialogue-elements/small-talk/#small-talk"><span class="std std-ref">Small Talk</span></a> and <a class="reference internal" href="../../dialogue-elements/completing-tasks/#simple-questions"><span class="std std-ref">Simple Questions</span></a> .
For example, if your assistant can handle 100 FAQs and 50 different small talk intents, you can use a single retrieval
action to cover all of these.
From a dialogue perspective, these single-turn exchanges can all be treated equally, so this simplifies your stories.</p>
<p>Instead of having a lot of stories like:</p>
<div class="highlight-story notranslate"><div class="highlight"><pre><span></span><span class="gh">## weather</span>
<span class="vm">* ask_weather</span>
<span class="vm">   </span>- utter_ask_weather

<span class="gh">## introduction</span>
<span class="vm">* ask_name</span>
<span class="vm">   </span>- utter_introduce_myself

...
</pre></div>
</div>
<p>You can cover all of these with a single story where the above intents are grouped under a common <code class="docutils literal notranslate"><span class="pre">chitchat</span></code> intent:</p>
<div class="highlight-story notranslate"><div class="highlight"><pre><span></span><span class="gh">## chitchat</span>
<span class="vm">* chitchat</span>
<span class="vm">   </span>- respond_chitchat
</pre></div>
</div>
<p>A retrieval action uses the output of a <a class="reference internal" href="../../nlu/components/#response-selector"><span class="std std-ref">ResponseSelector</span></a> component from NLU which learns a
retrieval model to predict the correct response from a list of candidate responses given a user message text.</p>
</div>
<div class="section" id="training-data">
<span id="retrieval-training-data"></span><h2><a class="toc-backref" href="#id4">Training Data</a><a class="headerlink" href="#training-data" title="Permalink to this headline">Â¶</a></h2>
<p>Like the name suggests, retrieval actions learn to select the correct response from a list of candidates.
As with other NLU data, you need to include examples of what your users will say in your NLU file:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="gu">##</span> intent: chitchat/ask_name
<span class="k">-</span> what&#39;s your name
<span class="k">-</span> who are you?
<span class="k">-</span> what are you called?

<span class="gu">##</span> intent: chitchat/ask_weather
<span class="k">-</span> how&#39;s weather?
<span class="k">-</span> is it sunny where you are?
</pre></div>
</div>
<p>First, all of these examples will be combined into a single <code class="docutils literal notranslate"><span class="pre">chitchat</span></code> retrieval intent that NLU will predict.
All retrieval intents have a suffix added to them which identifies a particular response text for your assistant, in the
above example - <code class="docutils literal notranslate"><span class="pre">ask_name</span></code> and <code class="docutils literal notranslate"><span class="pre">ask_weather</span></code>. The suffix is separated from the intent name by a <code class="docutils literal notranslate"><span class="pre">/</span></code> delimiter</p>
<p>Next, include response texts for all retrieval intents in a <strong>separate</strong> training data file as <code class="docutils literal notranslate"><span class="pre">responses.md</span></code>:</p>
<div class="highlight-md notranslate"><div class="highlight"><pre><span></span><span class="gu">##</span> ask name
<span class="k">*</span> chitchat/ask_name
    <span class="k">-</span> my name is Sara, Rasa&#39;s documentation bot!

<span class="gu">##</span> ask weather
<span class="k">*</span> chitchat/ask_weather
    <span class="k">-</span> it&#39;s always sunny where I live
</pre></div>
</div>
<p>The retrieval model is trained separately as part of the NLU training pipeline to select the correct response.
One important thing to remember is that the retrieval model uses the text of the response messages
to select the correct one. If you change the text of these responses, you have to retrain your retrieval model!
This is a key difference to the response templates in your domain file.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The file containing response texts must exist as a separate file inside the training data directory passed
to the training process. The contents of it cannot be a part of the file which contains training data for other
components of NLU.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As shown in the above examples, <code class="docutils literal notranslate"><span class="pre">/</span></code> symbol is reserved as a delimiter to separate retrieval intents from response text identifier. Make sure not to
use it in the name of your intents.</p>
</div>
</div>
<div class="section" id="config-file">
<h2><a class="toc-backref" href="#id5">Config File</a><a class="headerlink" href="#config-file" title="Permalink to this headline">Â¶</a></h2>
<p>You need to include the <a class="reference internal" href="../../nlu/components/#response-selector"><span class="std std-ref">ResponseSelector</span></a> component in your config. The component needs a tokenizer, a featurizer and an
intent classifier to operate on the user message before it can predict a response and hence these
components should be placed before <code class="docutils literal notranslate"><span class="pre">ResponseSelector</span></code> in the NLU configuration. An example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">language</span><span class="p">:</span> <span class="s">&quot;en&quot;</span>

<span class="nt">pipeline</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;WhitespaceTokenizer&quot;</span>
  <span class="nt">intent_split_symbol</span><span class="p">:</span> <span class="s">&quot;_&quot;</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;CountVectorsFeaturizer&quot;</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;EmbeddingIntentClassifier&quot;</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;ResponseSelector&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="domain">
<h2><a class="toc-backref" href="#id6">Domain</a><a class="headerlink" href="#domain" title="Permalink to this headline">Â¶</a></h2>
<p>Rasa uses a naming convention to match the intent names like <code class="docutils literal notranslate"><span class="pre">chitchat/ask_name</span></code>
to the retrieval action.
The correct action name in this case is <code class="docutils literal notranslate"><span class="pre">respond_chitchat</span></code>. The prefix <code class="docutils literal notranslate"><span class="pre">respond_</span></code> is mandatory to identify it as a
retrieval action. Another example - correct action name for <code class="docutils literal notranslate"><span class="pre">faq/ask_policy</span></code> would be <code class="docutils literal notranslate"><span class="pre">respond_faq</span></code>
To include this in your domain, add it to the list of actions:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">actions</span><span class="p">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">- respond_chitchat</span>
  <span class="l l-Scalar l-Scalar-Plain">- respond_faq</span>
</pre></div>
</div>
<p>A simple way to ensure that the retrieval action is predicted after the chitchat
intent is to use the <a class="reference internal" href="../policies/#mapping-policy"><span class="std std-ref">Mapping Policy</span></a>.
However, you can also include this action in your stories.
For example, if you want to repeat a question after handling chitchat
(see <a class="reference internal" href="../../dialogue-elements/completing-tasks/#unhappy-paths"><span class="std std-ref">Unhappy Paths</span></a> )</p>
<div class="highlight-story notranslate"><div class="highlight"><pre><span></span><span class="gh">## interruption</span>
<span class="vm">* search_restaurant</span>
<span class="vm">   </span>- utter_ask_cuisine
<span class="vm">* chitchat</span>
<span class="vm">   </span>- respond_chitchat
   - utter_ask_cuisine
</pre></div>
</div>
</div>
<div class="section" id="multiple-retrieval-actions">
<h2><a class="toc-backref" href="#id7">Multiple Retrieval Actions</a><a class="headerlink" href="#multiple-retrieval-actions" title="Permalink to this headline">Â¶</a></h2>
<p>If your assistant includes both FAQs <strong>and</strong> chitchat, it is possible to
separate these into separate retrieval actions, for example having intents
like <code class="docutils literal notranslate"><span class="pre">chitchat/ask_weather</span></code> and <code class="docutils literal notranslate"><span class="pre">faq/returns_policy</span></code>.
Rasa supports adding multiple <code class="docutils literal notranslate"><span class="pre">RetrievalActions</span></code> like <code class="docutils literal notranslate"><span class="pre">respond_chitchat</span></code> and <code class="docutils literal notranslate"><span class="pre">respond_returns_policy</span></code>
To train separate retrieval models for each of the intents, you need to include a separate <code class="docutils literal notranslate"><span class="pre">ResponseSelector</span></code>
component in the config:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">language</span><span class="p">:</span> <span class="s">&quot;en&quot;</span>

<span class="nt">pipeline</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;WhitespaceTokenizer&quot;</span>
  <span class="nt">intent_split_symbol</span><span class="p">:</span> <span class="s">&quot;_&quot;</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;CountVectorsFeaturizer&quot;</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;EmbeddingIntentClassifier&quot;</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;ResponseSelector&quot;</span>
  <span class="nt">retrieval_intent</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">chitchat</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;ResponseSelector&quot;</span>
  <span class="nt">retrieval_intent</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">faq</span>
</pre></div>
</div>
<dl class="simple">
<dt>You could still have two separate retrieval actions but both actions can share the same retrieval model by specifying a single</dt><dd><p><code class="docutils literal notranslate"><span class="pre">ResponseSelector</span></code> component and leaving the <code class="docutils literal notranslate"><span class="pre">retrieval_intent</span></code> to its default value(None):</p>
</dd>
</dl>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">language</span><span class="p">:</span> <span class="s">&quot;en&quot;</span>

<span class="nt">pipeline</span><span class="p">:</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;WhitespaceTokenizer&quot;</span>
  <span class="nt">intent_split_symbol</span><span class="p">:</span> <span class="s">&quot;_&quot;</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;CountVectorsFeaturizer&quot;</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;EmbeddingIntentClassifier&quot;</span>
<span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;ResponseSelector&quot;</span>
</pre></div>
</div>
<p>In this case, the response selector will be trained on examples from both <code class="docutils literal notranslate"><span class="pre">chitchat/{x}</span></code> and <code class="docutils literal notranslate"><span class="pre">faq/{x}</span></code> and will be
identified by the name <code class="docutils literal notranslate"><span class="pre">default</span></code> the NLU parsed output.</p>
<p>In our experiments so far, having separate retrieval models does <strong>not</strong> make any difference to the accuracy of each
retrieval action. So for simplicity, we recommend you use a single retrieval
model for both chitchat and FAQs
If you get different results, please let us know in the <a class="reference external" href="https://forum.rasa.com">forum</a> !</p>
</div>
<div class="section" id="parsing-response-selector-output">
<h2><a class="toc-backref" href="#id8">Parsing Response Selector Output</a><a class="headerlink" href="#parsing-response-selector-output" title="Permalink to this headline">Â¶</a></h2>
<p>The parsed output from NLU will have a property named <code class="docutils literal notranslate"><span class="pre">response_selector</span></code> containing the output for
each response selector. Each response selector is identified by <code class="docutils literal notranslate"><span class="pre">retrieval_intent</span></code> parameter of that response selector
and stores two properties -</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">response</span></code>: The predicted response text and the prediction confidence.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ranking</span></code>: Ranking with confidences of top 10 candidate responses.</p></li>
</ul>
</div></blockquote>
<p>Example result:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;What is the recommend python version to install?&quot;</span><span class="p">,</span>
    <span class="nt">&quot;entities&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="nt">&quot;intent&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;confidence&quot;</span><span class="p">:</span> <span class="mf">0.6485910906220309</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;faq&quot;</span><span class="p">},</span>
    <span class="nt">&quot;intent_ranking&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span><span class="nt">&quot;confidence&quot;</span><span class="p">:</span> <span class="mf">0.6485910906220309</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;faq&quot;</span><span class="p">},</span>
        <span class="p">{</span><span class="nt">&quot;confidence&quot;</span><span class="p">:</span> <span class="mf">0.1416153159565678</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;greet&quot;</span><span class="p">}</span>
    <span class="p">],</span>
    <span class="nt">&quot;response_selector&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;faq&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;response&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;confidence&quot;</span><span class="p">:</span> <span class="mf">0.7356462617</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Supports 3.5, 3.6 and 3.7, recommended version is 3.6&quot;</span><span class="p">},</span>
        <span class="nt">&quot;ranking&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="nt">&quot;confidence&quot;</span><span class="p">:</span> <span class="mf">0.7356462617</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Supports 3.5, 3.6 and 3.7, recommended version is 3.6&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="nt">&quot;confidence&quot;</span><span class="p">:</span> <span class="mf">0.2134543431</span><span class="p">,</span> <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;You can ask me about how to get started&quot;</span><span class="p">}</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">retrieval_intent</span></code> parameter of a particular response selector was left to its default value,
the corresponding response selector will be identified as <code class="docutils literal notranslate"><span class="pre">default</span></code> in the returned output.</p>
</div>
</div>


          </div>

          <div class="footer">
            <div class="questions">
              Stuck?
              <a class="reference external" href="https://forum.rasa.com" target="_blank">Ask a Question</a>
              or
              <a class="reference external" href="https://github.com/rasahq/rasa/issues" target="_blank">Create an Issue</a>
            </div>
            <div class="social">
              <a href="https://github.com/RasaHQ" target="_blank" title="GitHub"><i class="fab fa-github"></i></a>
              <a href="https://stackoverflow.com/search?q=rasa" target="_blank" title="Stack Overflow"><i class="fab fa-stack-overflow"></i></a>
              <a href="https://www.youtube.com/channel/UCJ0V6493mLvqdiVwOKWBODQ" target="_blank" title="YouTube"><i class="fab fa-youtube"></i></a>
              <a href="https://twitter.com/rasa_hq" target="_blank" title="Twitter"><i class="fab fa-twitter"></i></a>
            </div>

            <div class="copyright small">
            &copy;2020, Rasa Technologies | <a href="https://rasa.com/imprint/" target="_blank">Imprint</a> | <a href="https://rasa.com/privacy-policy/" target="_blank">Privacy Policy</a>
            
            </div>

          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>


    

  <script>
    window.dataLayer = window.dataLayer || [];

    function gtag(...arguments) {
      dataLayer.push(...arguments);
    }
    gtag('js', new Date());
    gtag('config', 'UA-87333416-1', {
      'anonymize_ip': true,
    });
  </script>
  <script src="https://rasa.com/assets/js/js.cookies.js"></script>
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script type="opt-in" data-name="analytics" data-type="text/javascript" data-src="https://www.googletagmanager.com/gtag/js?id=UA-87333416-1"></script>
  <script type="opt-in" data-name="analytics" data-type="text/javascript" data-src="https://rasa.com/assets/js/userId.js"></script>

  <script type="text/javascript">
    var clipboard = new ClipboardJS('.copyable');
    clipboard.on('success', function(e) {
      gtag('event', e.action, {
        'event_category': 'code',
        'event_label': e.text
      });
      const id = e.text.replace(/ /g,'-');
      document.getElementById(id).classList.add('visible');
      setTimeout(function(){
        document.getElementById(id).classList.remove('visible');},
        800
      );
    });
    clipboard.on('error', function(e) {
      console.log(e);
    });

  </script>

  <!-- ACE Editor, Train & download buttons -->
  <script>
    let updateIntervalId;

    function uuidv4() {
      return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
              (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
      );
    }

    function fetchTracker(url, chatBlockId, conversationId) {
      $.ajax({
        url: url + "/conversations/" + conversationId + "/tracker",
        method: "get",
        dataType: 'json',
        contentType: 'application/json',
        success: function(tracker, status) {
          initChatBlock(url, chatBlockId, conversationId, tracker);
        }
      });
    }

    function sendMessage(url, chatBlockId, conversationId, tracker, message) {
      $.ajax({
        url: url + "/webhooks/rest/webhook",
        method: "post",
        dataType: 'json',
        contentType: 'application/json',
        data: JSON.stringify({
          sender: conversationId,
          message: message
        }),
        success: function(result, status) {
          fetchTracker(url, chatBlockId, conversationId);
        },
      });
    }

    function startFetchingTracker(url, chatBlockId, conversationId) {
      const interval = 2000;

      fetchTracker(url, chatBlockId, conversationId);

      updateIntervalId = setInterval(() => {
        fetchTracker(url, chatBlockId, conversationId);
      }, interval);
    }

    function initChatBlock(url, id, conversationId, tracker) {
      ChatBlock.default.init({
        onSendMessage: (message) => {
          sendMessage(url, id, conversationId, tracker, message);
        },
        username: conversationId,
        tracker: tracker,
        selector: id
      });
    }

    const chatBlockId = '#rasa-chat-block';
    const trackingId = uuidv4();

    $(document).ready(() => {
      // make editors work
      const editors = document.querySelectorAll('.ace-editor');

      const assignTrainingDataToButton = function(e, id, trainButton) {
        const trainingData = trainButton.data('training');

        trainButton.data('training', JSON.stringify({
          ...JSON.parse(trainingData || "{}") || {},
          [id]: e.getValue(),
        }));
      };

      ace.config.set('modePath', "/_static/ace/src-min-noconflict");

      Array.from(editors).forEach(function(editor) {
        const e = ace.edit(editor);
        const id = editor.dataset['id'];
        const trackingEndpoint = editor.dataset['tr-endpoint'];

        e.session.setMode("ace/mode/" + editor.dataset['language']);
        e.renderer.setShowGutter(false);
        e.renderer.setShowPrintMargin(false);
        e.renderer.setPadding(24);
        e.renderer.setScrollMargin(24);
        e.setHighlightActiveLine(false);

        if (trackingEndpoint) {
          e.on("change", function() {
            if (!editor.dataset.hasChanged) {
              editor.dataset.hasChanged = true;
              $.ajax({
                url: trackingEndpoint,
                method: "POST",
                data: {editor: id},
              });
            }
          });
        }

        const trainButton = $('.train__button');

        assignTrainingDataToButton(e, id, trainButton);
        e.on("blur", function() {
          assignTrainingDataToButton(e, id, trainButton);
        });

        editor.style.height = editor.dataset['height'] + 'px';
      });

      // initialize a chat block
      initChatBlock("", chatBlockId, trackingId, {});
    });

    // set train button callback
    $( ".train__button" ).click(function() {
      const trainButton = $('.train__button');
      const trainSpinner = $('.train__spinner');
      const downloadButton = $('.download__button');

      trainButton.prop("disabled", true);
      downloadButton.prop("disabled", true);
      trainSpinner.removeClass('train__spinner--hidden');

      if (updateIntervalId) {
        clearInterval(updateIntervalId);
        initChatBlock("", chatBlockId, trackingId, {});
      }

      $.ajax({
        url: trainButton.data('endpoint'),
        method: trainButton.data('method'),
        dataType: 'json',
        contentType: 'application/json',
        data: JSON.stringify({ tracking_id: trackingId, ...JSON.parse(trainButton.data('training')) }),
        success: function(result, status) {
          trainSpinner.addClass('train__spinner--hidden');
          trainButton.prop("disabled", false);

          if (result['project_download_url']) {
            trainSpinner.addClass('train__spinner--hidden');
            downloadButton.prop("disabled", false);
            downloadButton.data("url", result['project_download_url']);
          }

          if (result['rasa_service_url']) {
            const conversationId = uuidv4();
            startFetchingTracker(result['rasa_service_url'], chatBlockId, conversationId);
          }
        },
        error: function(result, status) {
          trainSpinner.addClass('train__spinner--hidden');
          trainButton.prop("disabled", false);
        }
      });
    });

    // set download button callback
    $( ".download__button" ).click(function() {
      const downloadButton = $('.download__button');
      const url = downloadButton.data("url");

      if (url) {
        location.href = url;
      }
    });
  </script>

  <!-- Dismissable announcement banner -->
  <script>
    var banners = document.querySelectorAll('.announcement-banner');

    Array.from(banners).forEach(function(banner) {
      var cookie_id = banner.dataset['cookie-id'];

      if (localStorage.getItem(cookie_id) !== 'true') {
        banner.classList.add('announcement-banner--visible');
      }

      var bannerCloseButton = banner.querySelector('.announcement-banner__close');

      bannerCloseButton && bannerCloseButton.addEventListener('click', function() {
        localStorage.setItem(cookie_id, 'true');
        banner.classList.remove('announcement-banner--visible');
      });
    });
  </script>

  <!-- onsite anchor fix (otherwise anchors scroll to far) -->
  <script>
    /* Adapted from https://stackoverflow.com/a/13067009/1906073 */
    (function(document, history, location) {
      var HISTORY_SUPPORT = !!(history && history.pushState);

      var anchorScrolls = {
        ANCHOR_REGEX: /^#[^ ]+$/,
        OFFSET_HEIGHT_PX: 66,

        /**
         * Establish events, and fix initial scroll position if a hash is provided.
         */
        init: function() {
          this.scrollToCurrent();
          $(window).on('hashchange', $.proxy(this, 'scrollToCurrent'));
          $('body').on('click', 'a', $.proxy(this, 'delegateAnchors'));
        },

        /**
         * Return the offset amount to deduct from the normal scroll position.
         * Modify as appropriate to allow for dynamic calculations
         */
        getFixedOffset: function() {
          return this.OFFSET_HEIGHT_PX;
        },

        /**
         * If the provided href is an anchor which resolves to an element on the
         * page, scroll to it.
         * @param  {String} href
         * @return {Boolean} - Was the href an anchor.
         */
        scrollIfAnchor: function(href, pushToHistory) {
          var match, anchorOffset;

          if(!this.ANCHOR_REGEX.test(href)) {
            return false;
          }

          match = document.getElementById(href.slice(1));

          if(match) {
            anchorOffset = $(match).offset().top - this.getFixedOffset();
            $('html, body').animate({ scrollTop: anchorOffset});

            // Add the state to history as-per normal anchor links
            if(HISTORY_SUPPORT && pushToHistory) {
              history.pushState({}, document.title, location.pathname + href);
            }
          }

          return !!match;
        },

        /**
         * Attempt to scroll to the current location's hash.
         */
        scrollToCurrent: function(e) {
          if(this.scrollIfAnchor(window.location.hash) && e) {
            e.preventDefault();
          }
        },

        /**
         * If the click event's target was an anchor, fix the scroll position.
         */
        delegateAnchors: function(e) {
          var elem = e.target;

          if(this.scrollIfAnchor(elem.getAttribute('href'), true)) {
            e.preventDefault();
          }
        }
      };

      $(document).ready($.proxy(anchorScrolls, 'init'));
    })(window.document, window.history, window.location);

  </script>
  <script type="opt-in" data-name="analytics" data-type="text/javascript" data-src="https://rasa.com/assets/js/u-info.js"></script>
      <div class="webchat-banner webchat-banner--hidden">
        <img src="https://rasa.com/assets/img/demo/sara_avatar.png" class="webchat-banner__avatar" alt="">
        ðŸ‘‹ I can help you get started with Rasa and answer your technical questions.
        <button class="webchat-banner__close">
          <i class="fas fa-times"></i> 
        </button>
      </div>
      <div id="webchat">
        <script src="../../_static/rasa-webchat.js"></script>
        <script>
          WebChat.default.init({
            selector: "#webchat",
            initPayload: "/greet",
            socketUrl: "https://website-demo.rasa.com/",
            socketPath: "/socket.io",
            title: "Sara",
            subtitle: "I'm still in development",
            profileAvatar: "https://rasa.com/assets/img/demo/sara_avatar.png",
            showCloseButton: true,
            fullScreenMode: false,
            hideWhenNotConnected: false,
            connectOn: "open",
            autoClearCache: true,
            linksOpenTab: false,
            openLauncherImage: "../../_static/chat-icon.svg",
            customMessageDelay: (message) => {
              return 900 + message.length;
            },
            params: {
              storage: "local"
            },
            onWidgetEvent: {
              onChatOpen: () => {
                const webchatBanner = document.querySelector('.webchat-banner');
                if (webchatBanner) {
                  localStorage.setItem('WEBCHAT_BANNER_DISMISSED', 'true');
                  webchatBanner.classList.add('webchat-banner--hidden');
                }
              }
            }
          });

          try {
            const webchatBanner = document.querySelector('.webchat-banner');

            if (webchatBanner) {
              if (localStorage.getItem('WEBCHAT_BANNER_DISMISSED') !== 'true') {
                webchatBanner.classList.remove('webchat-banner--hidden');
              }

              const webChatBannerClose = document.querySelector('.webchat-banner__close');

              webChatBannerClose && webChatBannerClose.addEventListener('click', function() {
                localStorage.setItem('WEBCHAT_BANNER_DISMISSED', 'true');
                webchatBanner.classList.add('webchat-banner--hidden');
              });
            }
          } catch (e) {}
        </script>
      </div>
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>

  </body>
</html>